{"version":3,"file":"index.js","sources":["../../src/store.ts"],"sourcesContent":["import { Store, Action, Listener, Middleware, Reducer } from './types';\n\nexport class MicroStore<T> implements Store<T> {\n    private state: T;\n    private listeners: Set<Listener<T>> = new Set();\n    private middlewares: Middleware<T>[] = [];\n    private reducers: Reducer<T>[] = [];\n\n    constructor(initialState: T) {\n        this.state = initialState;\n    }\n\n    public getState(): T {\n        return this.state;\n    }\n\n    public dispatch(action: Action): void {\n        let newState = this.state;\n\n        // 应用所有reducers\n        for (const reducer of this.reducers) {\n            newState = reducer(newState, action);\n        }\n\n        // 应用所有中间件\n        for (const middleware of this.middlewares) {\n            newState = middleware(newState, action);\n        }\n\n        if (newState !== this.state) {\n            this.state = newState;\n            this.notify();\n        }\n    }\n\n    public subscribe(listener: Listener<T>): () => void {\n        this.listeners.add(listener);\n\n        // 返回取消订阅函数\n        return () => {\n            this.listeners.delete(listener);\n        };\n    }\n\n    public use(middleware: Middleware<T>): void {\n        this.middlewares.push(middleware);\n    }\n\n    public addReducer(reducer: Reducer<T>): void {\n        this.reducers.push(reducer);\n    }\n\n    private notify(): void {\n        this.listeners.forEach(listener => listener(this.state));\n    }\n}"],"names":[],"mappings":";;MAEa,UAAU,CAAA;AAMnB,IAAA,WAAA,CAAY,YAAe,EAAA;AAJnB,QAAA,IAAA,CAAA,SAAS,GAAqB,IAAI,GAAG,EAAE,CAAC;QACxC,IAAW,CAAA,WAAA,GAAoB,EAAE,CAAC;QAClC,IAAQ,CAAA,QAAA,GAAiB,EAAE,CAAC;AAGhC,QAAA,IAAI,CAAC,KAAK,GAAG,YAAY,CAAC;KAC7B;IAEM,QAAQ,GAAA;QACX,OAAO,IAAI,CAAC,KAAK,CAAC;KACrB;AAEM,IAAA,QAAQ,CAAC,MAAc,EAAA;AAC1B,QAAA,IAAI,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC;;AAG1B,QAAA,KAAK,MAAM,OAAO,IAAI,IAAI,CAAC,QAAQ,EAAE;AACjC,YAAA,QAAQ,GAAG,OAAO,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;SACxC;;AAGD,QAAA,KAAK,MAAM,UAAU,IAAI,IAAI,CAAC,WAAW,EAAE;AACvC,YAAA,QAAQ,GAAG,UAAU,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;SAC3C;AAED,QAAA,IAAI,QAAQ,KAAK,IAAI,CAAC,KAAK,EAAE;AACzB,YAAA,IAAI,CAAC,KAAK,GAAG,QAAQ,CAAC;YACtB,IAAI,CAAC,MAAM,EAAE,CAAC;SACjB;KACJ;AAEM,IAAA,SAAS,CAAC,QAAqB,EAAA;AAClC,QAAA,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;;AAG7B,QAAA,OAAO,MAAK;AACR,YAAA,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;AACpC,SAAC,CAAC;KACL;AAEM,IAAA,GAAG,CAAC,UAAyB,EAAA;AAChC,QAAA,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;KACrC;AAEM,IAAA,UAAU,CAAC,OAAmB,EAAA;AACjC,QAAA,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;KAC/B;IAEO,MAAM,GAAA;AACV,QAAA,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,QAAQ,IAAI,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;KAC5D;AACJ;;;;"}