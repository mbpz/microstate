!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).MicroState={})}(this,(function(t){"use strict";function e(t,e,s,i){return new(s||(s=Promise))((function(o,n){function a(t){try{h(i.next(t))}catch(t){n(t)}}function r(t){try{h(i.throw(t))}catch(t){n(t)}}function h(t){var e;t.done?o(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(a,r)}h((i=i.apply(t,e||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;t.MicroState=class{constructor(t,e={}){if(this.listeners=new Set,this.middlewares=[],this.options=Object.assign({storage:"undefined"!=typeof window?window.localStorage:void 0},e),this.options.name&&this.options.storage){const e=this.options.storage.getItem(this.options.name);if(e)try{this.state=JSON.parse(e)}catch(e){console.warn(`Failed to parse saved state for store "${this.options.name}"`,e),this.state=t}else this.state=t}else this.state=t}getState(){return this.state}use(t){this.middlewares.push(t)}applyMiddlewares(t,s){return e(this,void 0,void 0,(function*(){const e={getState:()=>this.state,dispatch:t=>this.update(t)};let i=s;for(const s of this.middlewares)i=yield s(e)(t,i);return i}))}update(t){return e(this,void 0,void 0,(function*(){const e=this.state,s=yield t(e);if(s!==e){const t=yield this.applyMiddlewares(e,s);if(this.state=t,this.options.name&&this.options.storage)try{this.options.storage.setItem(this.options.name,JSON.stringify(this.state))}catch(t){console.warn(`Failed to save state for store "${this.options.name}"`,t)}this.notify()}}))}subscribe(t){return this.listeners.add(t),()=>{this.listeners.delete(t)}}notify(){this.listeners.forEach((t=>t(this.state)))}clear(){this.options.name&&this.options.storage&&this.options.storage.removeItem(this.options.name)}}}));
//# sourceMappingURL=microstate.umd.js.map
