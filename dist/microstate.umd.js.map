{"version":3,"file":"microstate.umd.js","sources":["../src/store.ts"],"sourcesContent":["import { Store, Action, Listener, Middleware, Reducer } from './types';\n\nexport class MicroStore<T> implements Store<T> {\n    private state: T;\n    private listeners: Set<Listener<T>> = new Set();\n    private middlewares: Middleware<T>[] = [];\n    private reducers: Reducer<T>[] = [];\n\n    constructor(initialState: T) {\n        this.state = initialState;\n    }\n\n    public getState(): T {\n        return this.state;\n    }\n\n    public dispatch(action: Action): void {\n        let newState = this.state;\n\n        // 应用所有reducers\n        for (const reducer of this.reducers) {\n            newState = reducer(newState, action);\n        }\n\n        // 应用所有中间件\n        for (const middleware of this.middlewares) {\n            newState = middleware(newState, action);\n        }\n\n        if (newState !== this.state) {\n            this.state = newState;\n            this.notify();\n        }\n    }\n\n    public subscribe(listener: Listener<T>): () => void {\n        this.listeners.add(listener);\n\n        // 返回取消订阅函数\n        return () => {\n            this.listeners.delete(listener);\n        };\n    }\n\n    public use(middleware: Middleware<T>): void {\n        this.middlewares.push(middleware);\n    }\n\n    public addReducer(reducer: Reducer<T>): void {\n        this.reducers.push(reducer);\n    }\n\n    private notify(): void {\n        this.listeners.forEach(listener => listener(this.state));\n    }\n}"],"names":["constructor","initialState","this","listeners","Set","middlewares","reducers","state","getState","dispatch","action","newState","reducer","middleware","notify","subscribe","listener","add","delete","use","push","addReducer","forEach"],"mappings":"qQAQI,WAAAA,CAAYC,GAJJC,KAAAC,UAA8B,IAAIC,IAClCF,KAAWG,YAAoB,GAC/BH,KAAQI,SAAiB,GAG7BJ,KAAKK,MAAQN,CAChB,CAEM,QAAAO,GACH,OAAON,KAAKK,KACf,CAEM,QAAAE,CAASC,GACZ,IAAIC,EAAWT,KAAKK,MAGpB,IAAK,MAAMK,KAAWV,KAAKI,SACvBK,EAAWC,EAAQD,EAAUD,GAIjC,IAAK,MAAMG,KAAcX,KAAKG,YAC1BM,EAAWE,EAAWF,EAAUD,GAGhCC,IAAaT,KAAKK,QAClBL,KAAKK,MAAQI,EACbT,KAAKY,SAEZ,CAEM,SAAAC,CAAUC,GAIb,OAHAd,KAAKC,UAAUc,IAAID,GAGZ,KACHd,KAAKC,UAAUe,OAAOF,EAAS,CAEtC,CAEM,GAAAG,CAAIN,GACPX,KAAKG,YAAYe,KAAKP,EACzB,CAEM,UAAAQ,CAAWT,GACdV,KAAKI,SAASc,KAAKR,EACtB,CAEO,MAAAE,GACJZ,KAAKC,UAAUmB,SAAQN,GAAYA,EAASd,KAAKK,QACpD"}